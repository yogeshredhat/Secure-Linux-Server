How to Set up SSH Two Factor Authentication on Ubuntu 16.04 with Google Authenticator
-------------------------------------------------------------------------------------

Google Authenticator generates a one-time password using a shared secret key and the current time. 
Not only do you need to provide the correct username and password, but also have to enter a one-time password 
generated by Google Authenticator to log in to your SSH server.

Step 1
------

apt-get update && apt-get upgrade -y

reboot

login through ssh

Create User yogesh
------------------ 

adduser yogesh

Assign Passwd

Step 2
------

su - yogesh

sudo apt install libpam-google-authenticator

Install google authenticator App in your mobile

google-authenticator

When asked “Do you want authentication tokens to be time-based?” Answer y.

Then You will  be shown a QR code that you can scan using the Google Authenticator mobile app.

Step 3
------

Do you want me to update your "/home/<username>/.google_authenticator" file (y/n) y

Do you want to disallow multiple uses of the same authentication
token? This restricts you to one login about every 30s, but it increases
your chances to notice or even prevent man-in-the-middle attacks (y/n) y



By default, tokens are good for 30 seconds and in order to compensate for
possible time-skew between the client and the server, we allow an extra
token before and after the current time. If you experience problems with poor
time synchronization, you can increase the window from its default
size of 1:30min to about 4min. Do you want to do so (y/n)y


If the computer that you are logging into isn't hardened against brute-force
login attempts, you can enable rate-limiting for the authentication module.
By default, this limits attackers to no more than 3 login attempts every 30s.
Do you want to enable rate-limiting (y/n) y


step 4
------

sudo vim /etc/pam.d/sshd

Then, add the below line at the bottom of the file:


auth required pam_google_authenticator.so

Step 5
------

vim /etc/ssh/sshd_config

ChallengeResponseAuthentication yes

AuthenticationMethods keyboard-interactive

sudo systemctl restart sshd


Step 6
------

open new Tab

login via ssh

it will ask login passwd after that verification code

--------------------------------------------------------------------------------------------------------------------------------------

Reference URL
-------------

https://www.alibabacloud.com/blog/how-to-protect-ssh-with-multi-factor-authentication-on-ubuntu-16-04_594091

https://www.youtube.com/watch?v=Ng0A-PzyUcg








